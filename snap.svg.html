<!DOCTYPE html>
<html>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  <meta content="utf-8" http-equiv="encoding" />
  <link rel="stylesheet" type="text/css" href="/style.css" />
  <title>snap.svg</title>
  <script src="/snap.svg.js"></script>


  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  <script>
    fetch('/api/api/sqlserver/JDEVTAS/getPlano', {
      method: 'GET',
      mode: 'cors',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
    })
      .then(response => response.text())
      .then(response => {
        console.log(response)
      })
      .catch(error => {
        console.error('Error:', error);
      });
  </script>
</head>

<body>
  <!--<div class="container">-->
  <!-- tarjeta de convenciones-->
  <div id="mycard" class="card">
    <div class="card-body" id="card-body">
      <h6 class="card-title">
        <strong>Información Estado apartamentos:</strong>
      </h6>
      <hr id="line">
    </div>

    <p class="card-text">
    <p id="elpopover">POR LANZAR
    <div class="square"></div>
    </p>
    <p id="elpopover">EN SALA
    <div class="square1"></div>
    </p>
    <p id="elpopover">OPCIONADO
    <div class="square2"></div>
    </p>
    <p id="elpopover">VENDIDO
    <div class="square3"></div>
    </p>
    <p id="elpopover">VENDIDO MES ACTUAL
    <div class="square4"></div>
    </p>
    <p id="elpopover">ESCRITURADO
    <div class="square5"></div>
    </p>
    </p>
  </div>

  <!-- </div>-->

  <!--plano svg-->
  <figure id="plano">
    <object style="height: 100%; width: 60%;" id="svg"></object>
  </figure>
  <script>
    var state2 = false;
    var torre1 = true;
    var s = Snap("#svg");
    //Archivo de diseño del plano 
    var name = "/LA FLORA 20-07-10 (1).svg";
    const name3 = {};
    //archivo Json de la consulta por servicio Rest
    //Consumir dependencia axios, consumo web rest



    var name2 = {
      "estado": "Aprovado [A]",
      "mensaje": "Efecty",
      "listaId": [
        {
          "id": "L0105",
          "color": "#A0C0F8",
          "estado": "vendido mes actual"
        },
        {
          "id": "L0209",
          "color": "#7EABFA",
          "estado": "vendido"
        },
        {
          "id": "L0314",
          "color": "#F9F511",
          "estado": "opcionado"
        },
        {
          "id": "L0406",
          "color": "#1AED0C",
          "estado": "en sala(venta)"
        },
        {
          "id": "L0508",
          "color": "#FFFFFF",
          "estado": "por lanzar"
        },
        {
          "id": "L0608",
          "color": "#00244D",
          "estado": "Escriturado"
        },
        {
          "id": "L0702",
          "color": "#A0C0F8",
          "estado": "vendido mes actual"
        },
        {
          "id": "L0808",
          "color": "#7EABFA",
          "estado": "vendido"
        },
        {
          "id": "L0913",
          "color": "#F9F511",
          "estado": "opcionado"
        },
        {
          "id": "L1005",
          "color": "#1AED0C",
          "estado": "en sala(venta)"
        },
        {
          "id": "L1101",
          "color": "#FFFFFF",
          "estado": "por lanzar"
        },
        {
          "id": "L1202",
          "color": "#00244D",
          "estado": "Escriturado"
        },
        {
          "id": "L1302",
          "color": "#A0C0F8",
          "estado": "vendido mes actual"
        },
        {
          "id": "L1408",
          "color": "#7EABFA",
          "estado": "vendido"
        },
        {
          "id": "L1513",
          "color": "#F9F511",
          "estado": "opcionado"
        },
        {
          "id": "L1605",
          "color": "#1AED0C",
          "estado": "en sala(venta)"
        },
        {
          "id": "L1701",
          "color": "#FFFFFF",
          "estado": "por lanzar"
        },
        {
          "id": "L1802",
          "color": "#00244D",
          "estado": "Escriturado"
        }
      ]
    };

    function assingData(data) {
      name3 = data
    }
    async function funcionAsincrona() {
        const  respuesta = await fetch('/api/api/sqlserver/JDEVTAS/getPlano', {
          method: 'GET',
          mode: 'cors',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
        })
          .then(response => response.text())
          .then(response => {
            console.log(response)
            data3 = response
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }

      await funcionAsincrona()
      console.log("name3 == " + name3)




    //Carga del plano usando Snap
    var fragment = Snap.load(name, (data) => {
      //Asignación de colores a los apartamentos por estado 
      s.append(data);
      console.log("name3 == " + name3)
      funcionAsincrona()




      

      for (var i = 0; i < name2.listaId.length; i++) {
        var apto = document.getElementById(name2.listaId[i].id);
        apto.style.fill = name2.listaId[i].color;
        apto.style.opacity = "0.7";
        //document.getElementById(name2.listaId[i].id).onmouseover = function() {mouseOver()};
        //document.getElementById(name2.listaId[i].id).onmouseout = function() {mouseOut()};
        apto.addEventListener('mouseover', myFunc, false);
      }
      /*function mouseOver(){
        for (var i = 0; i < name2.listaId.length; i++) {
          if(this.id == name2.listaId[i].id){
            var pru = document.createElement("button");
            document.body.appendChild(pru);
        } 
      }
      }*/
      function myFunc() {
        for (var i = 0; i < name2.listaId.length; i++) {
          if (this.id == name2.listaId[i].id) {
            var pru = document.createElement("button");
            document.body.appendChild(pru);
          }
        }
      }

      //Declaración de las capas del frente Torre1
      var frenteTorre1 = document.getElementById("layer5");
      var vistaFrenteTorre1 = document.getElementById("layer6");

      //función para remover las 2 capas del Frente Torre1
      const handleButtonClickFrenteTorre1Hide = () => {

        frenteTorre1.style.visibility = "hidden"
        vistaFrenteTorre1.style.visibility = "hidden"

        //frenteTorre1.remove()
        //vistaFrenteTorre1.remove()
        torre1 = false;
      };
      //función para mostrar las 2 capas del Frente Torre1
      const handleButtonClickFrenteTorre1Show = () => {

        frenteTorre1.style.visibility = "visible"
        vistaFrenteTorre1.style.visibility = "visible"

        //s.append(frenteTorre1)
        //s.append(vistaFrenteTorre1)
        torre1 = true
      };

      //Asignación del botón respecto a la base Torre 1
      var buttonBaseTorre1 = document.getElementById("L_ADM_TORRE_01_0");
      buttonBaseTorre1.onclick = handleButtonClickFrenteTorre1Show;

      //Asignación del botón respecto al frente Torre 1
      var buttonFrenteTorre1 = document.getElementById("L_ADM_TORRE_01_1");
      buttonFrenteTorre1.onclick = handleButtonClickFrenteTorre1Hide;

      //Declaración de las capas del frente Torre2
      var frenteTorre2 = document.getElementById("layer3");
      var vistaFrenteTorre2 = document.getElementById("layer4");

      //función para mostrar las 2 capas del Frente Torre2
      const handleButtonClickFrenteTorre2Show = () => {

        frenteTorre2.style.visibility = "visible"
        vistaFrenteTorre2.style.visibility = "visible"
        //s.append(frenteTorre2)
        //s.append(vistaFrenteTorre2)
        //validación de la superposición con el frente Torre1
        //if (torre1) {

        //  s.append(frenteTorre1)
        //  s.append(vistaFrenteTorre1)
        //}
      };
      //función para remover las 2 capas del Frente Torre2
      const handleButtonClickFrenteTorre2Hide = () => {

        frenteTorre2.style.visibility = "hidden"
        vistaFrenteTorre2.style.visibility = "hidden"

        //frenteTorre2.remove()
        //vistaFrenteTorre2.remove()
      };

      //Asignación del botón respecto a la base Torre 2
      var buttonBaseTorre2 = document.getElementById("L_ADM_TORRE_02_0");
      buttonBaseTorre2.onclick = handleButtonClickFrenteTorre2Show;

      //Asignación del botón respecto al frente Torre 2
      var buttonFrenteTorre2 = document.getElementById("L_ADM_TORRE_02_1");
      buttonFrenteTorre2.onclick = handleButtonClickFrenteTorre2Hide;

    });
  </script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous"></script>
  <!--<svg></svg> -->
</body>

</html>